<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>Современные лучшие практики для тестирования на Java</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Современные лучшие практики для тестирования на Java</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Поддерживаемый и читаемый тестовый код имеет решающее значение для обеспечения хорошего тестового покрытия, которое, в свою очередь, позволяет внедрять новые функции и выполнять рефакторинг, не опасаясь что-то сломать. Некоторые рекомендации могут быть очевидны для вас, но некоторые могут противоречить тому, что вы читали в книгах о разработке и тестировании программного обеспечения.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_too_long_didnt_read_tldr">Too Long; Didn&#8217;t Read (TL;DR)</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Пишите небольшие и специфические тесты, активно используя вспомогательные функции, параметризованные тесты, мощные утверждения <strong>AssertJ</strong>, не злоупотребляя переменными, проверяя только то, что имеет значение, и избегайте одного теста для всех пограничных случаев.</p>
</li>
<li>
<p>Пишите автономные тесты, раскрывая все соответствующие параметры, вставляйте данные прямо в тест и предпочитайте композицию наследованию.</p>
</li>
<li>
<p>Пишите глупые тесты, избегая повторного использования производственного кода и сосредотачиваясь на сравнении выходных значений с жестко закодированными значениями.</p>
</li>
<li>
<p><strong>KISS</strong> &gt; <strong>DRY</strong></p>
</li>
<li>
<p>Тестируйте в окружении близком к производству, сосредотачиваясь на тестировании всей функции (в том чисде всех ее слоев) и избегайте использования баз данных в памяти.</p>
</li>
<li>
<p><strong>JUnit5</strong> и <strong>AssertJ</strong> - очень хороший выбор.</p>
</li>
<li>
<p>Инвестируйте в тестируемую реализацию, избегая статического доступа, используя внедрение по средствам конструктора, используя <strong>Clocks</strong> и отделяйте бизнес-логику от асинхронного выполнения.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_главное">Главное</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_given_when_then">Given, When, Then</h3>
<div class="paragraph">
<p>Тест должен содержать три блока, разделенных одной пустой строкой. Каждый блок кода должен быть как можно короче. Используйте подметоды, чтобы сократить эти блоки.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Given</strong> (<strong>Input</strong>): подготовка к тесту, например создание данных или настройка макетов</p>
</li>
<li>
<p><strong>When</strong> (<strong>Action</strong>): вызовите метод или действие, которое вы хотите протестировать.</p>
</li>
<li>
<p><strong>Then</strong> (<strong>Output</strong>): выполнить <strong>assertions</strong>, чтобы проверить правильность вывода или поведения действия.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
@Test
public void findProduct() {
    insertIntoDatabase(new Product(100, "Smartphone"));

    Product product = dao.findProduct(100);

    assertThat(product.getName()).isEqualTo("Smartphone");
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_используйте_префиксы_actual_и_expected">Используйте префиксы <code>actual*</code> и <code>expected*</code>.</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
ProductDTO product1 = requestProduct(1);

ProductDTO product2 = new ProductDTO("1", List.of(State.ACTIVE, State.REJECTED))
assertThat(product1).isEqualTo(product2);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если вы собираетесь использовать переменные в утверждении равенства, поставьте перед переменными префикс <code>actual*</code> и <code>expected*</code>. Это увеличивает удобочитаемость и проясняет назначение переменной. Более того, их сложнее перепутать в <strong>assertions</strong> равенства.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
ProductDTO actualProduct = requestProduct(1);

ProductDTO expectedProduct = new ProductDTO("1", List.of(State.ACTIVE, State.REJECTED))
assertThat(actualProduct).isEqualTo(expectedProduct); // nice and clear.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_используйте_фиксированные_данные_вместо_случайных_данных">Используйте фиксированные данные вместо случайных данных</h3>
<div class="paragraph">
<p>Избегайте случайных данных, так как это может привести к переключению тестов, которые может быть сложно отладить, и пропуску сообщений об ошибках, которые затрудняют отслеживание ошибки до кода.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
Instant ts1 = Instant.now(); // 1557582788
Instant ts2 = ts1.plusSeconds(1); // 1557582789
int randomAmount = new Random().nextInt(500); // 232
UUID uuid = UUID.randomUUID(); // d5d1f61b-0a8b-42be-b05a-bd458bb563ad</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вместо этого используйте фиксированные значения для всего, потому что они будут создавать:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Легко воспроизводимые тесты, которые легко отлаживать.</p>
</li>
<li>
<p>Сообщения об ошибках, которые можно легко отследить до соответствующей строки кода.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
Instant ts1 = Instant.ofEpochSecond(1550000001);
Instant ts2 = Instant.ofEpochSecond(1550000002);
int amount = 50;
UUID uuid = UUID.fromString("00000000-000-0000-0000-000000000001");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_пишите_небольшие_и_узкоспециализированные_тесты">Пишите небольшие и узкоспециализированные тесты</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_активно_используйте_вспомогательные_функции">Активно используйте вспомогательные функции</h3>
<div class="paragraph">
<p>Извлеките детали или повторяющийся код в подфункции и дайте им описательное имя. Это мощное средство, позволяющее сделать тесты короткими, а основы теста легкими для понимания с первого взгляда.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
@Test
public void categoryQueryParameter() throws Exception {
    List&lt;ProductEntity&gt; products = List.of(
            new ProductEntity().setId("1").setName("Envelope").setCategory("Office")
                    .setDescription("An Envelope").setStockAmount(1),
            new ProductEntity().setId("2").setName("Pen").setCategory("Office")
                    .setDescription("A Pen").setStockAmount(1),
            new ProductEntity().setId("3").setName("Notebook").setCategory("Hardware")
                    .setDescription("A Notebook").setStockAmount(2)
    );
    for (ProductEntity product : products) {
        template.execute(createSqlInsertStatement(product));
    }

    String responseJson = client.perform(get("/products?category=Office"))
            .andExpect(status().is(200))
            .andReturn().getResponse().getContentAsString();

    assertThat(toDTOs(responseJson))
            .extracting(ProductDTO::getId)
            .containsOnly("1", "2");
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
@Test
public void categoryQueryParameter2() throws Exception {
    insertIntoDatabase(
            createProductWithCategory("1", "Office"),
            createProductWithCategory("2", "Office"),
            createProductWithCategory("3", "Hardware")
    );

    String responseJson = requestProductsByCategory("Office");

    assertThat(toDTOs(responseJson))
            .extracting(ProductDTO::getId)
            .containsOnly("1", "2");
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Используйте <strong>вспомогательные функции</strong> для создания данных/объектов (e.g.: <code>createProductWithCategory()</code>) и сложных утверждений. Передавайте вспомогательным функциям только те параметры, которые имеют отношение к вашим тестам. Используйте разумные значения по умолчанию для других значений. В Kotlin это легко сделать с помощью аргументов по умолчанию. В Java вы должны использовать цепочку методов и перегрузку для имитации аргументов по умолчанию.</p>
</li>
<li>
<p><strong>varargs</strong> может сделать ваш тестовый код еще более лаконичным (e.g.: <code>ìnsertIntoDatabase()</code>).</p>
</li>
<li>
<p><strong>Вспомогательные функции</strong> также можно использовать для более простого создания простых значений. Это оченб удобно в <strong>Kotlin</strong>, где для этого можно использовать <strong>функции расширения</strong>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do (Java)
var ts = toInstant(1); // Instant.ofEpochSecond(1550000001)
var id = toUUID(1); // UUID.fromString("00000000-0000-0000-a000-000000000001")</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">// Do (Kotlin)
val ts = 1.toInstant()
val id = 1.toUUID()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Вспомогательные функции</strong> могут быть реализованы в <strong>Kotlin</strong> следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun Int.toInstant(): Instant = Instant.ofEpochSecond(this.toLong())

fun Int.toUUID(): UUID = UUID.fromString("00000000-0000-0000-a000-${this.toString().padStart(11, '0')}")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_не_злоупотребляйте_переменными">Не злоупотребляйте переменными</h3>
<div class="paragraph">
<p>Обычный рефлекс разработчика — извлекать значения, которые многократно используются, в переменные.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
@Test
public void variables() throws Exception {
    String relevantCategory = "Office";
    String id1 = "4243";
    String id2 = "1123";
    String id3 = "9213";
    String irrelevantCategory = "Hardware";
    insertIntoDatabase(
        createProductWithCategory(id1, relevantCategory),
        createProductWithCategory(id2, relevantCategory),
        createProductWithCategory(id3, irrelevantCategory)
    );

    String responseJson = requestProductsByCategory(relevantCategory);

    assertThat(toDTOs(responseJson))
            .extracting(ProductDTO::getId)
            .containsOnly(id1, id2);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>К сожалению, это значительно раздувает тестовый код. Более того, учитывая сообщение об ошибке теста, сложнее понять в какой строчке кода проблема.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>KISS</strong> &gt; <strong>DRY</strong>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
@Test
public void variables() throws Exception {
    insertIntoDatabase(
        createProductWithCategory("4243", "Office"),
        createProductWithCategory("1123", "Office"),
        createProductWithCategory("9213", "Hardware")
    );

    String responseJson = requestProductsByCategory("Office");

    assertThat(toDTOs(responseJson))
            .extracting(ProductDTO::getId)
            .containsOnly("4243", "1123");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если сделать тесты маленькими, что очень рекомендуется, то легко увидеть, где используются те же значения. Кроме того, тестовый метод будет еще короче и поэтому его будет легче понять. Так же будет легче отследить код, содержащий ошибку, используя сообщения об ошибках.</p>
</div>
</div>
<div class="sect2">
<h3 id="_не_расширяйте_существующие_тесты_чтобы_просто_протестировать_еще_одну_маленькую_вещь">Не расширяйте существующие тесты, чтобы «просто протестировать еще одну маленькую вещь»</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
public class ProductControllerTest {
    @Test
    public void happyPath() {
        // a lot of code comes here...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Заманчиво добавить угловой тест к существующему тесту (счастливый путь). Но этот тест становится все сложнее и сложнее. Становится трудно понять все соответствующие тестовые случаи, которые охватываются этим большим тестом. Вы можете определить эти тесты по общим названиям, например, «тест счастливого пути». Если этот тест не пройден, трудно понять, что именно сломано.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
public class ProductControllerTest {
    @Test
    public void multipleProductsAreReturned() {
    }

    @Test
    public void allProductValuesAreReturned() {
    }

    @Test
    public void filterByCategory() {
    }

    @Test
    public void filterByDateCreated() {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вместо этого создайте новый тестовый метод с описательным именем, которое расскажет все об ожидаемом поведении. Да, это больше усилий, но зато можно создать индивидуальный и понятный тест, который проверяет только соответствующее поведение. Опять же, <strong>вспомогательные функции</strong> могут снизить трудоемкость. И, наконец, добавление специализированных тестов с описательными именами — отличный способ документировать реализованное поведение.</p>
</div>
</div>
<div class="sect2">
<h3 id="_проверяйте_только_то_что_нужно_протестировать">Проверяйте только то, что нужно протестировать</h3>
<div class="paragraph">
<p>Подумайте, что вы действительно хотите протестировать. Не нужно проверять все случаи только потому, что вы можете это сделать. Более того, нужно иметь в виду то, что уже тестировалось в предыдущих тестах; нет нужды проверять это снова и снова в каждом тесте. Это делает тесты короткими, четкими и явно указывает ожидаемое поведение.</p>
</div>
<div class="paragraph">
<p>Рассмотрим пример: тестирование HTTP endpoint, который возвращает продукты. Набор тестов должен содержать следующие тесты:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Крупный «тест сопоставления», который проверяет, что все значения из базы данных правильно возвращаются как JSON и правильно отображаются в правильный формат. Это можно легко сделать, используя <strong>AssertJ</strong>, если <code>equals()</code> реализован правильно:</p>
<div class="ulist">
<ul>
<li>
<p><code>isEqualTo()</code> - для одного элемента</p>
</li>
<li>
<p><code>containsOnly()</code> - для нескольких элементов.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String responseJson = requestProducts();

ProductDTO expectedDTO1 = new ProductDTO("1", "evelope", new Category("office"),
                                List.of(States.ACTIVE, States.REJECTED));
ProductDTO expectedDTO2 = new ProductDTO("2", "evelope", new Category("smartphone"),
                                List.of(States.ACTIVE));

assertThat(toDTOs(responseJson))
        .containsOnly(expectedDTO1, expectedDTO2);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Тест, проверяющие правильность поведения параметра запроса <code>?category</code>. Итак, нужно проверить правильность фильтрации, для этого не нужно проверять что все свойства установлены правильно. Это уже сделано в приведенном выше тесте. Следовательно, достаточно сравнить только возвращенные идентификаторы товаров.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String responseJson = requestProductsByCategory("Office");

assertThat(toDTOs(responseJson))
        .extracting(ProductDTO::getId)
        .containsOnly("1", "2");</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Tесты проверяющие пограничные случаи или специальную бизнес-логику. Например, проверка правильности значений, которые высчитываются. В этом случае интересно только определенное поле в JSON. Поэтому необходимо проверить только соответствующее поле, чтобы четко указать и задокументировать объем тестируемой логики. Опять же, нет необходимости снова проверять все поля, потому что это проверяется не здесь.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">assertThat(actualProduct.getPrice()).isEqualTo(100);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_автономные_тесты">Автономные тесты</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_не_скрывайте_соответствующие_параметры_в_вспомогательных_функциях">Не скрывайте соответствующие параметры (в вспомогательных функциях)</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
insertIntoDatabase(createProduct());
List&lt;ProductDTO&gt; actualProducts = requestProductsByCategory();
assertThat(actualProducts).containsOnly(new ProductDTO("1", "Office"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Да, вы должны использовать вспомогательные функции для создания данных и утверждений, но вы должны параметризовать их. Определите параметр для всего, что важно для теста и должно контролироваться тестом. Не заставляйте читателя переходить к определению функции, чтобы понять тест. Эмпирическое правило: вы должны понимать суть теста, глядя только на метод тестирования.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Do
insertIntoDatabase(createProduct("1", "Office"));
List&lt;ProductDTO&gt; actualProducts = requestProductsByCategory("Office");
assertThat(actualProducts).containsOnly(new ProductDTO("1", "Office"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вставьте тестовые данные прямо в метод тестирования
В методе тестирования все должно быть правильно. Заманчиво переместить в @Beforeметод повторно используемый код для вставки данных , но это заставит читателя прыгать, чтобы полностью понять, что происходит. Опять же, вспомогательные функции для вставки данных могут помочь сделать эту повторяющуюся задачу однострочным.</p>
</div>
<div class="paragraph">
<p>Предпочитайте композицию над наследованием
Не создавайте сложные иерархии наследования для тестовых классов.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Don't
class SimpleBaseTest {}
class AdvancedBaseTest extends SimpleBaseTest {}
class AllInklusiveBaseTest extends AdvancedBaseTest {}
class MyTest extends AllInklusiveBaseTest {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Эти иерархии трудно понять, и вы, вероятно, в конечном итоге расширите базовый тест, который содержит много вещей, которые текущему тесту не нужны. Это отвлекает читателя и может привести к ошибкам. Наследование не является гибким: невозможно использовать все, AllInklusiveBaseTestно ничего из его суперкласса AdvancedBaseTest? Более того, читателю приходится переключаться между несколькими базовыми классами, чтобы понять общую картину.</p>
</div>
</div>
<div class="sect2">
<h3 id="_предпочитайте_дублирование_неправильной_абстракции_санди_мец_см_стену_мудрости_кодирования">«Предпочитайте дублирование неправильной абстракции». Санди Мец. См. «Стену мудрости кодирования»</h3>
<div class="paragraph">
<p>Вместо этого я рекомендую использовать композицию. Напишите небольшие фрагменты кода и классы для каждой конкретной работы с приспособлениями (запустите тестовую базу данных, создайте схему, вставьте данные, запустите фиктивный веб-сервер). Повторно используйте эти части в своих тестах в @BeforeAllметоде или назначив созданные объекты полям тестового класса. Таким образом, вы собираете каждый новый тестовый класс, повторно используя эти части; как кирпичи лего. Таким образом, каждый тест имеет свое собственное приспособление, которое легко понять, и не происходит ничего постороннего. Тестовый класс самодостаточен, потому что все необходимое находится прямо в тестовом классе.</p>
</div>
<div class="paragraph">
<p>public class MyTest {
private JdbcTemplate template;
private MockWebServer taxService;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    @BeforeAll
    public void setupDatabaseSchemaAndMockWebServer() throws IOException {
        this.template = new DatabaseFixture().startDatabaseAndCreateSchema();
        this.taxService = new MockWebServer();
        taxService.start();
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>public class DatabaseFixture {
public JdbcTemplate startDatabaseAndCreateSchema() throws IOException {
PostgreSQLContainer db = new PostgreSQLContainer("postgres:11.2-alpine");
db.start();
DataSource dataSource = DataSourceBuilder.create()
.driverClassName("org.postgresql.Driver")
.username(db.getUsername())
.password(db.getPassword())
.url(db.getJdbcUrl())
.build();
JdbcTemplate template = new JdbcTemplate(dataSource);
SchemaCreator.createSchema(template);
return template;
}
}
Очередной раз:</p>
</div>
<div class="paragraph">
<p>KISS&gt; СУХОЙ</p>
</div>
<div class="paragraph">
<p>Глупые тесты - это здорово: сравните результат с жестко заданными значениями
Не используйте производственный код повторно
Тест должен тестировать производственный код; не используйте его повторно. Если вы повторно используете производственный код в тесте, вы можете пропустить ошибку, которая появляется в повторно используемом коде, потому что вы больше не тестируете этот код.</p>
</div>
<div class="paragraph">
<p>boolean isActive = true;
boolean isRejected = true;
insertIntoDatabase(new Product(1, isActive, isRejected));</p>
</div>
<div class="paragraph">
<p>ProductDTO actualDTO = requestProduct(1);</p>
</div>
<div class="paragraph">
<p>List&lt;State&gt; expectedStates = ProductionCode.mapBooleansToEnumList(isActive, isRejected);
assertThat(actualDTO.states).isEqualTo(expectedStates);
Вместо этого при написании тестов думайте о вводе и выводе. Тест устанавливает входные данные и сравнивает фактические выходные данные с жестко запрограммированными значениями. В большинстве случаев повторное использование кода не требуется.</p>
</div>
<div class="paragraph">
<p>assertThat(actualDTO.states).isEqualTo(List.of(States.ACTIVE, States.REJECTED));
Не переписывайте производственную логику
Код сопоставления - это типичный пример, когда логика тестов переписывается. Итак, давайте предположим, что наши тесты содержат метод, mapEntityToDto()результат которого используется для утверждения, что возвращенный DTO содержит те же значения, что и сущности, которые были вставлены в начале теста. В этом случае вы, скорее всего, закончите переписывать производственную логику в тестовом коде, который может содержать ошибки.</p>
</div>
<div class="paragraph">
<p>ProductEntity inputEntity = new ProductEntity(1, "evelope", "office", false, true, 200, 10.0);
insertIntoDatabase(input);</p>
</div>
<div class="paragraph">
<p>ProductDTO actualDTO = requestProduct(1);</p>
</div>
<div class="literalblock">
<div class="content">
<pre> // mapEntityToDto() contains the same mapping logic as the production code
ProductDTO expectedDTO = mapEntityToDto(inputEntity);
assertThat(actualDTO).isEqualTo(expectedDTO);
Опять же, решение состоит в том, чтобы сравнить фактический DTO с созданным вручную ссылочным объектом с жестко заданными значениями. Это предельно просто, легко понять и менее подвержено ошибкам.</pre>
</div>
</div>
<div class="paragraph">
<p>ProductDTO expectedDTO = new ProductDTO("1", "evelope", new Category("office"), List.of(States.ACTIVE, States.REJECTED))
assertThat(actualDTO).isEqualTo(expectedDTO);
Если вы не хотите сравнивать все значения и поэтому не хотите создавать полный объект ссылки, подумайте о том, чтобы сравнивать только подобъекты или только соответствующие значения.</p>
</div>
<div class="paragraph">
<p>Не пишите слишком много логики
Опять же, тестирование в основном касается ввода и вывода: предоставление вводимых данных и сравнение фактического вывода с ожидаемыми значениями. Следовательно, нам не нужно кодировать много логики в наших тестах, да и не следует. Если вы реализуете логику с большим количеством циклов и условий, вы сделаете тесты сложнее для понимания и более подверженными ошибкам. Более того, в случае сложной логики утверждений мощные утверждения AssertJ могут сделать за вас тяжелую работу.</p>
</div>
<div class="paragraph">
<p>Тест близок к реальности
Сосредоточьтесь на тестировании полного вертикального слайда
Обычно рекомендуется тестировать каждый класс изолированно с помощью имитаций. Однако у него есть недостатки : вы не тестируете все классы при интеграции, а рефакторинг внутренних компонентов сломает все тесты, потому что есть тест для каждого внутреннего класса. И, наконец, вы должны написать и поддерживать несколько тестов.</p>
</div>
<div class="paragraph">
<p>Модульное тестирование каждого класса изолированно и с помощью имитаций имеет недостатки.
Модульное тестирование каждого класса изолированно и с помощью имитаций имеет недостатки.</p>
</div>
<div class="paragraph">
<p>Вместо этого я предлагаю сосредоточиться на интеграционных тестах . Под «интеграционными тестами» (или «тестированием компонентов») я имею в виду объединение всех классов (как в производственной среде) и тестирование полного вертикального слайда, проходящего через все технические уровни (HTTP, бизнес-логика, база данных). Таким образом, вы тестируете поведение, а не реализацию. Эти тесты точны, близки к производственным и устойчивы к рефакторингу внутренних компонентов. В идеале нам нужно написать только один тестовый класс.</p>
</div>
<div class="paragraph">
<p>Я рекомендую сосредоточиться на интеграционном тестировании (= соединение реальных объектов вместе и тестирование всех сразу)
Я рекомендую сосредоточиться на интеграционном тестировании (= соединение реальных объектов вместе и тестирование всех сразу)</p>
</div>
<div class="paragraph">
<p>Тем не менее, модульные тесты полезны, и бывают ситуации, когда модульный тест является лучшим выбором или когда имеет смысл комбинировать оба подхода. Однако мой опыт показывает, что в большинстве случаев интеграционный тест является лучшим и достаточным выбором.</p>
</div>
<div class="paragraph">
<p>По этой теме можно сказать гораздо больше. Ознакомьтесь с моим сообщением в блоге «Сосредоточьтесь на тестах интеграции вместо тестов на основе макетов» для получения более подробной информации.</p>
</div>
<div class="paragraph">
<p>Не используйте базы данных в памяти для тестов
Используя базу данных в памяти, вы проводите тестирование с другой базой данных, чем в производственной среде.
Используя базу данных в памяти, вы проводите тестирование с другой базой данных, чем в производственной среде.</p>
</div>
<div class="paragraph">
<p>Использование базы данных в памяти ( H2 , HSQLDB , Fongo ) для тестов снижает надежность и объем ваших тестов. База данных в памяти и база данных, используемая в производственной среде, ведут себя по-разному и могут возвращать разные результаты. Таким образом, зеленый тест на основе базы данных в памяти не является гарантией правильного поведения вашего приложения в производственной среде. Более того, вы можете легко столкнуться с ситуациями, когда вы не можете использовать (или протестировать) определенную (специфичную для базы данных) функцию, потому что база данных в памяти не поддерживает ее или действует иначе. Подробнее об этом читайте в статье «Не использовать базы данных в памяти для тестов» .</p>
</div>
<div class="paragraph">
<p>Решение состоит в том, чтобы выполнить тесты на реальной базе данных. К счастью, библиотека Testcontainers предоставляет отличный Java API для управления контейнером прямо в тестовом коде. Чтобы увеличить скорость выполнения, см. Здесь .</p>
</div>
<div class="paragraph">
<p>Java / JVM
Использовать -noverify -XX:TieredStopAtLevel=1
Всегда добавляйте параметры JVM -noverify -XX:TieredStopAtLevel=1в свои конфигурации запуска. Это сэкономит 1-2 секунды при запуске JVM до выполнения теста. Это особенно полезно во время первоначальной разработки теста, когда вы часто запускаете тест через IDE.</p>
</div>
<div class="paragraph">
<p>Обновление: Начиная с Java 13, -noverifyне рекомендуется.</p>
</div>
<div class="paragraph">
<p>Совет: Вы можете добавить аргументы в шаблон конфигурации запуска «JUnit» в IntelliJ IDEA, чтобы вам не приходилось добавлять их для каждой новой конфигурации запуска.</p>
</div>
<div class="paragraph">
<p>Используйте AssertJ
AssertJ - чрезвычайно мощная и зрелая библиотека утверждений с плавным типобезопасным API, огромным разнообразием утверждений и описательных сообщений об ошибках. Есть утверждение для всего, что вы хотите сделать. Это не дает вам писать сложную логику утверждения с циклами и условиями, сохраняя при этом короткий тестовый код. Вот некоторые примеры:</p>
</div>
<div class="paragraph">
<p>assertThat(actualProduct)
.isEqualToIgnoringGivenFields(expectedProduct, "id");</p>
</div>
<div class="paragraph">
<p>assertThat(actualProductList).containsExactly(
createProductDTO("1", "Smartphone", 250.00),
createProductDTO("1", "Smartphone", 250.00)
);</p>
</div>
<div class="paragraph">
<p>assertThat(actualProductList)
.usingElementComparatorIgnoringFields("id")
.containsExactly(expectedProduct1, expectedProduct2);</p>
</div>
<div class="paragraph">
<p>assertThat(actualProductList)
.extracting(Product::getId)
.containsExactly("1", "2");</p>
</div>
<div class="paragraph">
<p>assertThat(actualProductList)
.anySatisfy(product &#8594; assertThat(product.getDateCreated()).isBetween(instant1, instant2));</p>
</div>
<div class="paragraph">
<p>assertThat(actualProductList)
.filteredOn(product &#8594; product.getCategory().equals("Smartphone"))
.allSatisfy(product &#8594; assertThat(product.isLiked()).isTrue());
Избегайте assertTrue()иassertFalse()
Избегайте простой assertTrue()или assertFalse()утверждения , поскольку они производят загадочные сообщения об ошибках:</p>
</div>
<div class="paragraph">
<p>assertTrue(actualProductList.contains(expectedProduct));
assertTrue(actualProductList.size() == 5);
assertTrue(actualProduct instanceof Product);
expected: &lt;true&gt; but was: &lt;false&gt;
Вместо этого используйте утверждения AssertJ, которые сразу же создают приятные сообщения об ошибках.</p>
</div>
<div class="paragraph">
<p>assertThat(actualProductList).contains(expectedProduct);
assertThat(actualProductList).hasSize(5);
assertThat(actualProduct).isInstanceOf(Product.class);
Expecting:
&lt;[Product[id=1, name='Samsung Galaxy']]&gt;
to contain:
&lt;[Product[id=2, name='iPhone']]&gt;
but could not find:
&lt;[Product[id=2, name='iPhone']]&gt;
Если вам действительно нужно проверить логическое значение, подумайте о AssertJ,as() чтобы улучшить сообщение об ошибке .</p>
</div>
<div class="paragraph">
<p>Используйте JUnit5
JUnit5 - это новейший продукт для (модульного) тестирования. Он активно развивается и предоставляет множество мощных функций (например, параметризованные тесты, группирование, условные тесты, управление жизненным циклом).</p>
</div>
<div class="paragraph">
<p>Используйте параметризованные тесты
Параметризованные тесты позволяют повторно запускать один тест несколько раз с разными значениями. Таким образом, вы можете легко протестировать несколько случаев без написания тестового кода. JUnit5 предоставляет большие средства , чтобы написать эти тесты с @ValueSource, @EnumSource, @CsvSourceи @MethodSource.</p>
</div>
<div class="paragraph">
<p>@ParameterizedTest
@ValueSource(strings = ["§ed2d", "sdf_", "123123", "§_sdf__dfww!"])
public void rejectedInvalidTokens(String invalidToken) {
client.perform(get("/products").param("token", invalidToken))
.andExpect(status().is(400))
}</p>
</div>
<div class="paragraph">
<p>@ParameterizedTest
@EnumSource(WorkflowState::class, mode = EnumSource.Mode.INCLUDE, names = ["FAILED", "SUCCEEDED"])
public void dontProcessWorkflowInCaseOfAFinalState(WorkflowState itemsInitialState) {
}
Я настоятельно рекомендую широко использовать их, потому что вы можете протестировать больше случаев с минимальными усилиями.</p>
</div>
<div class="paragraph">
<p>Наконец, я хотел бы выделить @CsvSourceи @MethodSourceкоторые можно использовать для более сложных сценариев параметризованного тестирования, где вы также можете контролировать ожидаемый результат с помощью параметра.</p>
</div>
<div class="paragraph">
<p>@ParameterizedTest
@CsvSource({
"1, 1, 2",
"5, 3, 8",
"10, -20, -10"
})
public void add(int summand1, int summand2, int expectedSum) {
assertThat(calculator.add(summand1, summand2)).isEqualTo(expectedSum);
}
@MethodSourceявляется мощным в сочетании со специальным тестовым объектом, содержащим все соответствующие тестовые параметры и ожидаемый результат. К сожалению, в Java написание этих структур данных (POJO) обременительно. Вот почему я продемонстрирую эту функцию, используя классы данных Kotlin .</p>
</div>
<div class="paragraph">
<p>data class TestData(
val input: String?,
val expected: Token?
)</p>
</div>
<div class="paragraph">
<p>@ParameterizedTest
@MethodSource("validTokenProvider")
fun <code>parse valid tokens</code>(data: TestData) {
assertThat(parse(data.input)).isEqualTo(data.expected)
}</p>
</div>
<div class="paragraph">
<p>private fun validTokenProvider() = Stream.of(
TestData(input = "1511443755_2", expected = Token(1511443755, "2")),
TestData(input = "151175_13521", expected = Token(151175, "13521")),
TestData(input = "151144375_id", expected = Token(151144375, "id")),
TestData(input = "15114437599_1", expected = Token(15114437599, "1")),
TestData(input = null, expected = null)
)
Сгруппируйте тесты
JUnit5 @Nestedполезен для группировки методов тестирования. Разумными группами могут быть определенные типы тестов (например InputIsXY, ErrorCases) или одна группа для каждого тестируемого метода ( GetDesignи UpdateDesign).</p>
</div>
<div class="paragraph">
<p>public class DesignControllerTest {
@Nested
class GetDesigns {
@Test
void allFieldsAreIncluded() {}
@Test
void limitParameter() {}
@Test
void filterParameter() {}
}
@Nested
class DeleteDesign {
@Test
void designIsRemovedFromDb() {}
@Test
void return404OnInvalidIdParameter() {}
@Test
void return401IfNotAuthorized() {}
}
}
Сгруппируйте методы тестирования с помощью JUnit5 &amp; rsquo; s @Nested
Сгруппируйте методы тестирования с помощью JUnit5. @Nested</p>
</div>
<div class="paragraph">
<p>Читаемые имена тестов с @DisplayNameобратными кавычками или Kotlin
В Java используйте JUnit5 @DisplayNameдля создания читаемых описаний тестов.</p>
</div>
<div class="paragraph">
<p>public class DisplayNameTest {
@Test
@DisplayName("Design is removed from database")
void designIsRemoved() {}
@Test
@DisplayName("Return 404 in case of an invalid parameter")
void return404() {}
@Test
@DisplayName("Return 401 if the request is not authorized")
void return401() {}
}
Читаемые имена методов тестирования с JUnit5 &amp; rsquo; s @DisplayName
Читаемые имена тестовых методов с JUnit5 @DisplayName</p>
</div>
<div class="paragraph">
<p>В Kotlin вы можете помещать имена методов в обратные кавычки, которые могут содержать пробелы. Это обеспечивает хорошую читаемость без избыточности.</p>
</div>
<div class="paragraph">
<p>@Test
fun <code>design is removed from db</code>() {}
Имитация удаленной службы
Чтобы протестировать HTTP-клиентов, нам нужно имитировать удаленную службу. Я часто использую для этой цели OkHttp&#8217;s WebMockServer . Альтернативы - WireMock или Mockserver Testcontainer .</p>
</div>
<div class="paragraph">
<p>MockWebServer serviceMock = new MockWebServer();
serviceMock.start();
HttpUrl baseUrl = serviceMock.url("/v1/");
ProductClient client = new ProductClient(baseUrl.host(), baseUrl.port());
serviceMock.enqueue(new MockResponse()
.addHeader("Content-Type", "application/json")
.setBody("{\"name\": \"Smartphone\"}"));</p>
</div>
<div class="paragraph">
<p>ProductDTO productDTO = client.retrieveProduct("1");</p>
</div>
<div class="paragraph">
<p>assertThat(productDTO.getName()).isEqualTo("Smartphone");
Используйте ожидание для утверждения асинхронного кода
Awaitility - это библиотека для тестирования асинхронного кода. Вы можете легко определить, как часто утверждение будет повторяться до тех пор, пока окончательно не завершится ошибкой.</p>
</div>
<div class="paragraph">
<p>private static final ConditionFactory WAIT = await()
.atMost(Duration.ofSeconds(6))
.pollInterval(Duration.ofSeconds(1))
.pollDelay(Duration.ofSeconds(1));</p>
</div>
<div class="paragraph">
<p>@Test
public void waitAndPoll(){
triggerAsyncEvent();
WAIT.untilAsserted) &#8594; { assertThat(findInDatabase(1).getState(.isEqualTo(State.SUCCESS);
});
}
Таким образом, вы сможете избежать использования хрупкого материала Thread.sleep()в тестах.</p>
</div>
<div class="paragraph">
<p>Однако тестировать синхронный код намного проще. Вот почему мы должны попытаться разделить синхронный и асинхронный код, чтобы протестировать их отдельно .</p>
</div>
<div class="paragraph">
<p>Нет необходимости загружать DI (Spring)
Загрузка инфраструктуры (Spring) DI занимает несколько секунд, прежде чем можно будет начать тест. Это замедляет цикл обратной связи, особенно на начальном этапе разработки теста.</p>
</div>
<div class="paragraph">
<p>Вот почему я обычно не использую DI в своих интеграционных тестах. Я создаю экземпляры требуемых объектов вручную, вызывая newих и объединяя их вместе. Если вы используете инъекцию конструктора, это очень просто. В большинстве случаев вам нужно протестировать написанную вами бизнес-логику. Для этого вам не нужен DI. Посмотрите мой пост об интеграционных тестах для примера.</p>
</div>
<div class="paragraph">
<p>Более того, Spring Boot 2.2 представит простой способ использования ленивой инициализации bean-компонентов, что должно значительно ускорить тесты на основе DI.</p>
</div>
<div class="paragraph">
<p>Сделайте реализацию тестируемой
Не используйте статический доступ. Никогда. Когда-либо.
Статический доступ - это анти-шаблон. Во-первых, он скрывает зависимости и побочные эффекты, что затрудняет понимание всего кода и делает его более подверженным ошибкам. Во-вторых, статический доступ вредит тестируемости. Вы больше не можете обменивать предметы. Но в тесте вы хотите использовать макеты или использовать реальные объекты с другой конфигурацией (например, объект DAO, указывающий на тестовую базу данных).</p>
</div>
<div class="paragraph">
<p>Поэтому вместо статического доступа к коду поместите его в нестатические методы, создайте экземпляр класса и передайте объект конструктору объекта там, где он вам нужен.</p>
</div>
<div class="paragraph">
<p>public class ProductController {
public List&lt;ProductDTO&gt; getProducts() {
List&lt;ProductEntity&gt; products = ProductDAO.getProducts();
return mapToDTOs(products);
}
}
public class ProductController {
private ProductDAO dao;
public ProductController(ProductDAO dao) {
this.dao = dao;
}
public List&lt;ProductDTO&gt; getProducts() {
List&lt;ProductEntity&gt; products = dao.getProducts();
return mapToDTOs(products);
}
}
К счастью, фреймворки DI, такие как Spring, предоставляют простой способ избежать статического доступа, поскольку они обрабатывают создание и связывание всех объектов за нас.</p>
</div>
<div class="paragraph">
<p>Параметризация
Сделайте все соответствующие части класса контролируемыми тестом. Это можно сделать, создав параметр для конструктора из этого аспекта.</p>
</div>
<div class="paragraph">
<p>Например, ваш DAO имеет фиксированный лимит в 1000 запросов. Для проверки этого ограничения вам потребуется создать 1001 запись в базе данных. Используя параметр конструктора для этого ограничения, вы делаете его настраиваемым. В производстве этот параметр равен 1000. В тесте вы можете использовать 2. Это требует только 3 тестовых записей для тестирования функции ограничения.</p>
</div>
<div class="paragraph">
<p>Использовать внедрение конструктора
Полевая инъекция - зло из-за плохой тестируемости. Вы должны загрузить среду DI в своих тестах или совершить хакерскую магию отражения. Таким образом, внедрение конструктора является предпочтительным способом, поскольку он позволяет легко управлять зависимым объектом в тесте.</p>
</div>
<div class="paragraph">
<p>В Java для этого требуется немного шаблонов.</p>
</div>
<div class="paragraph">
<p>public class ProductController {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private ProductDAO dao;
private TaxClient client;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public CustomerResource(ProductDAO dao, TaxClient client) {
        this.dao = dao;
        this.client = client;
    }
}
В Котлине то же самое гораздо лаконичнее.</pre>
</div>
</div>
<div class="paragraph">
<p>class ProductController(
private val dao: ProductDAO,
private val client: TaxClient
){
}
Не используйте Instant.now()илиnew Date()
Не получайте текущую метку времени, вызывая Instant.now()или new Date()в производственном коде, если вы хотите проверить это поведение.</p>
</div>
<div class="paragraph">
<p>public class ProductDAO {
public void updateDateModified(String productId) {
Instant now = Instant.now(); // !
Update update = Update()
.set("dateModified", now);
Query query = Query()
.addCriteria(where("_id").eq(productId));
return mongoTemplate.updateOne(query, update, ProductEntity.class);
}
}
Проблема в том, что созданная временная метка не может контролироваться тестом. Вы не можете утверждать точное значение, потому что оно всегда разное при каждом выполнении теста. Вместо этого используйте Clockкласс Java .</p>
</div>
<div class="paragraph">
<p>public class ProductDAO {
private Clock clock;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public ProductDAO(Clock clock) {
    this.clock = clock;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    public void updateProductState(String productId, State state) {
        Instant now = clock.instant();
        // ...
    }
}
В тесте теперь вы можете создать макет часов, передать его в ProductDAOи настроить макет часов, чтобы он возвращал фиксированную метку времени. После вызова updateProductState()мы проверяем, попала ли указанная временная метка в базу данных.</pre>
</div>
</div>
<div class="paragraph">
<p>Раздельное асинхронное выполнение и фактическая логика
Тестировать асинхронный код сложно. Такие библиотеки, как Awaitility, могут помочь, но они по-прежнему громоздки, и тесты все еще могут переключаться. Если возможно, имеет смысл отделить (часто синхронную) бизнес-логику от асинхронного выполнения этой логики.</p>
</div>
<div class="paragraph">
<p>Например, поместив бизнес-логику в ProductController, мы можем протестировать ее синхронно, что легко. Асинхронная логика и логика распараллеливания централизованы в платформе ProductScheduler, которую можно тестировать изолированно.</p>
</div>
<div class="paragraph">
<p>public class ProductScheduler {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private ProductController controller;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    @Scheduled
    public void start() {
        CompletableFuture&lt;String&gt; usFuture = CompletableFuture.supplyAsync(() -&gt; controller.doBusinessLogic(Locale.US));
        CompletableFuture&lt;String&gt; germanyFuture = CompletableFuture.supplyAsync(() -&gt; controller.doBusinessLogic(Locale.GERMANY));
        String usResult = usFuture.get();
        String germanyResult = germanyFuture.get();
    }
}</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-01-18 05:06:02 UTC
</div>
</div>
</body>
</html>